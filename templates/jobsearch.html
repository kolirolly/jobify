{% extends 'base.html' %}
{% block content %}
<div class="container mx-auto px-4 py-8 max-w-4xl bg-gray-900 rounded-lg">
  <h1 class="text-3xl font-bold text-white mb-6">Upload Your Resume ðŸ“„</h1>

  <form id="upload-form" class="bg-white shadow-md rounded-lg p-6 mb-8">
    <div class="mb-4">
      <input type="file" id="file" name="file" required 
             class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100" />
    </div>
    <div class="mb-4">
      <input type="text" id="location" name="location" placeholder="Preferred Location (optional)"
             class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" />
    </div>
    <button type="submit" 
            class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition duration-300">
      Submit
    </button>
  </form>

  <h2 class="text-2xl font-semibold text-white mb-4">Extracted Skills</h2>
  <ul id="skills-list" class="list-disc pl-6 mb-8 text-gray-300"></ul>

  <h2 class="text-2xl font-semibold text-white mb-4">Matching Jobs</h2>
  <div class="overflow-x-auto">
    <table id="jobs-table" class="w-full border-collapse bg-white shadow-md rounded-lg">
      <thead>
        <tr class="bg-gray-100">
          <th class="py-3 px-4 text-left text-gray-600 font-medium">Title</th>
          <th class="py-3 px-4 text-left text-gray-600 font-medium">Company</th>
          <th class="py-3 px-4 text-left text-gray-600 font-medium">Location</th>
          <th class="py-3 px-4 text-left text-gray-600 font-medium">Link</th>
        </tr>
      </thead>
      <tbody class="text-gray-700"></tbody>
    </table>
  </div>
</div>
<script>
  document.getElementById('upload-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = new FormData();
    formData.append('file', document.getElementById('file').files[0]);
    formData.append('location', document.getElementById('location').value || 'Remote');

    const response = await fetch('/job-search', {
      method: 'POST',
      body: formData
    });

    const data = await response.json();
    const skillsList = document.getElementById('skills-list');
    const jobsTable = document.getElementById('jobs-table').querySelector('tbody');

    // Populate skills
    skillsList.innerHTML = '';
    data.skills.forEach(skill => {
      const li = document.createElement('li');
      li.textContent = skill;
      skillsList.appendChild(li);
    });

    // Populate jobs
    jobsTable.innerHTML = '';
    data.jobs.forEach(job => {
      const row = document.createElement('tr');
      row.className = 'border-b hover:bg-blue-50 transition duration-200';
      row.innerHTML = `
        <td class="py-3 px-4">${job.title}</td>
        <td class="py-3 px-4">${job.company}</td>
        <td class="py-3 px-4">${job.location}</td>
        <td class="py-3 px-4"><a href="${job.url}" target="_blank" class="text-blue-600 hover:text-blue-800 underline">Apply</a></td>
      `;
      jobsTable.appendChild(row);
    });
  });
</script>
{% endblock %}